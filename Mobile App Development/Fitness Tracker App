import React, { useState, useEffect } from 'react';
import { Dumbbell, Plus, TrendingUp, Target, Calendar, Award, Activity, Clock, Flame, Zap, Edit2, Trash2, Check, X } from 'lucide-react';

export default function FitnessTrackerApp() {
  const [view, setView] = useState('dashboard'); // dashboard, log, history, goals
  const [workouts, setWorkouts] = useState([]);
  const [goals, setGoals] = useState([]);
  const [showWorkoutForm, setShowWorkoutForm] = useState(false);
  const [showGoalForm, setShowGoalForm] = useState(false);
  const [workoutForm, setWorkoutForm] = useState({
    type: 'cardio',
    name: '',
    duration: '',
    calories: '',
    distance: '',
    reps: '',
    sets: '',
    weight: '',
    notes: ''
  });
  const [goalForm, setGoalForm] = useState({
    type: 'workout',
    target: '',
    current: 0,
    deadline: ''
  });

  const workoutTypes = [
    { value: 'cardio', label: 'Cardio', icon: 'üèÉ' },
    { value: 'strength', label: 'Strength', icon: 'üí™' },
    { value: 'yoga', label: 'Yoga', icon: 'üßò' },
    { value: 'sports', label: 'Sports', icon: '‚öΩ' },
    { value: 'cycling', label: 'Cycling', icon: 'üö¥' },
    { value: 'swimming', label: 'Swimming', icon: 'üèä' }
  ];

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    try {
      const workoutKeys = await window.storage.list('workout:');
      if (workoutKeys && workoutKeys.keys) {
        const workoutPromises = workoutKeys.keys.map(async (key) => {
          const result = await window.storage.get(key);
          return result ? JSON.parse(result.value) : null;
        });
        const loadedWorkouts = (await Promise.all(workoutPromises)).filter(Boolean);
        setWorkouts(loadedWorkouts.sort((a, b) => new Date(b.date) - new Date(a.date)));
      }

      const goalKeys = await window.storage.list('goal:');
      if (goalKeys && goalKeys.keys) {
        const goalPromises = goalKeys.keys.map(async (key) => {
          const result = await window.storage.get(key);
          return result ? JSON.parse(result.value) : null;
        });
        const loadedGoals = (await Promise.all(goalPromises)).filter(Boolean);
        setGoals(loadedGoals);
      }
    } catch (error) {
      console.log('No existing data found');
    }
  };

  const logWorkout = async () => {
    if (!workoutForm.name || !workoutForm.duration) {
      alert('Please fill in required fields');
      return;
    }

    const workout = {
      id: `workout:${Date.now()}`,
      ...workoutForm,
      date: new Date().toISOString()
    };

    try {
      await window.storage.set(workout.id, JSON.stringify(workout));
      setWorkouts([workout, ...workouts]);
      resetWorkoutForm();
      setShowWorkoutForm(false);
    } catch (error) {
      console.error('Error saving workout:', error);
    }
  };

  const deleteWorkout = async (id) => {
    try {
      await window.storage.delete(id);
      setWorkouts(workouts.filter(w => w.id !== id));
    } catch (error) {
      console.error('Error deleting workout:', error);
    }
  };

  const createGoal = async () => {
    if (!goalForm.target || !goalForm.deadline) {
      alert('Please fill in all fields');
      return;
    }

    const goal = {
      id: `goal:${Date.now()}`,
      ...goalForm,
      createdAt: new Date().toISOString()
    };

    try {
      await window.storage.set(goal.id, JSON.stringify(goal));
      setGoals([...goals, goal]);
      resetGoalForm();
      setShowGoalForm(false);
    } catch (error) {
      console.error('Error saving goal:', error);
    }
  };

  const updateGoalProgress = async (goalId, newProgress) => {
    const goal = goals.find(g => g.id === goalId);
    const updatedGoal = { ...goal, current: newProgress };
    
    try {
      await window.storage.set(goalId, JSON.stringify(updatedGoal));
      setGoals(goals.map(g => g.id === goalId ? updatedGoal : g));
    } catch (error) {
      console.error('Error updating goal:', error);
    }
  };

  const deleteGoal = async (id) => {
    try {
      await window.storage.delete(id);
      setGoals(goals.filter(g => g.id !== id));
    } catch (error) {
      console.error('Error deleting goal:', error);
    }
  };

  const resetWorkoutForm = () => {
    setWorkoutForm({
      type: 'cardio',
      name: '',
      duration: '',
      calories: '',
      distance: '',
      reps: '',
      sets: '',
      weight: '',
      notes: ''
    });
  };

  const resetGoalForm = () => {
    setGoalForm({
      type: 'workout',
      target: '',
      current: 0,
      deadline: ''
    });
  };

  // Statistics calculations
  const getStats = () => {
    const thisWeek = workouts.filter(w => {
      const workoutDate = new Date(w.date);
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      return workoutDate >= weekAgo;
    });

    const totalWorkouts = thisWeek.length;
    const totalCalories = thisWeek.reduce((sum, w) => sum + (parseInt(w.calories) || 0), 0);
    const totalDuration = thisWeek.reduce((sum, w) => sum + (parseInt(w.duration) || 0), 0);
    const totalDistance = thisWeek.reduce((sum, w) => sum + (parseFloat(w.distance) || 0), 0);

    return {
      totalWorkouts,
      totalCalories,
      totalDuration,
      totalDistance,
      avgCaloriesPerWorkout: totalWorkouts > 0 ? Math.round(totalCalories / totalWorkouts) : 0
    };
  };

  const stats = getStats();

  const formatDate = (dateStr) => {
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
  };

  const formatTime = (minutes) => {
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return hours > 0 ? `${hours}h ${mins}m` : `${mins}m`;
  };

  const getWorkoutTypeIcon = (type) => {
    return workoutTypes.find(t => t.value === type)?.icon || 'üèãÔ∏è';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-orange-900 via-red-900 to-pink-900 p-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="flex items-center justify-between mb-6">
          <div className="flex items-center gap-3">
            <Dumbbell className="text-orange-300" size={40} />
            <div>
              <h1 className="text-4xl font-bold text-white">FitTrack</h1>
              <p className="text-orange-200">Your personal fitness companion</p>
            </div>
          </div>
          <button
            onClick={() => setShowWorkoutForm(true)}
            className="px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-semibold flex items-center gap-2 transition-all shadow-lg"
          >
            <Plus size={20} />
            Log Workout
          </button>
        </div>

        {/* Navigation */}
        <div className="bg-white/10 backdrop-blur-lg rounded-xl p-2 mb-6 border border-white/20 flex gap-2">
          {[
            { id: 'dashboard', label: 'Dashboard', icon: Activity },
            { id: 'history', label: 'History', icon: Calendar },
            { id: 'goals', label: 'Goals', icon: Target }
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => setView(tab.id)}
              className={`flex-1 px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-all ${
                view === tab.id
                  ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg'
                  : 'text-orange-200 hover:bg-white/10'
              }`}
            >
              <tab.icon size={20} />
              {tab.label}
            </button>
          ))}
        </div>

        {/* Dashboard View */}
        {view === 'dashboard' && (
          <div className="space-y-6">
            {/* Stats Cards */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div className="flex items-center justify-between mb-2">
                  <Activity className="text-blue-400" size={24} />
                  <span className="text-2xl font-bold text-white">{stats.totalWorkouts}</span>
                </div>
                <p className="text-orange-200">Workouts This Week</p>
              </div>

              <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div className="flex items-center justify-between mb-2">
                  <Flame className="text-red-400" size={24} />
                  <span className="text-2xl font-bold text-white">{stats.totalCalories}</span>
                </div>
                <p className="text-orange-200">Calories Burned</p>
              </div>

              <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div className="flex items-center justify-between mb-2">
                  <Clock className="text-green-400" size={24} />
                  <span className="text-2xl font-bold text-white">{formatTime(stats.totalDuration)}</span>
                </div>
                <p className="text-orange-200">Total Time</p>
              </div>

              <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div className="flex items-center justify-between mb-2">
                  <TrendingUp className="text-purple-400" size={24} />
                  <span className="text-2xl font-bold text-white">{stats.totalDistance.toFixed(1)}</span>
                </div>
                <p className="text-orange-200">Total Distance (km)</p>
              </div>
            </div>

            {/* Recent Workouts */}
            <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
              <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <Zap className="text-yellow-400" />
                Recent Workouts
              </h2>
              {workouts.length === 0 ? (
                <div className="text-center py-12">
                  <Dumbbell className="mx-auto text-orange-300 mb-4 opacity-50" size={64} />
                  <p className="text-orange-200 text-lg">No workouts logged yet</p>
                  <p className="text-orange-300 text-sm mt-2">Start tracking your fitness journey!</p>
                </div>
              ) : (
                <div className="space-y-3">
                  {workouts.slice(0, 5).map(workout => (
                    <div
                      key={workout.id}
                      className="bg-white/10 rounded-lg p-4 hover:bg-white/20 transition-colors"
                    >
                      <div className="flex items-start justify-between">
                        <div className="flex items-start gap-3 flex-1">
                          <span className="text-3xl">{getWorkoutTypeIcon(workout.type)}</span>
                          <div className="flex-1">
                            <h3 className="text-lg font-bold text-white mb-1">{workout.name}</h3>
                            <div className="flex flex-wrap gap-4 text-sm text-orange-300">
                              <span className="flex items-center gap-1">
                                <Clock size={14} />
                                {workout.duration} min
                              </span>
                              {workout.calories && (
                                <span className="flex items-center gap-1">
                                  <Flame size={14} />
                                  {workout.calories} cal
                                </span>
                              )}
                              {workout.distance && (
                                <span>{workout.distance} km</span>
                              )}
                              {workout.sets && workout.reps && (
                                <span>{workout.sets} sets √ó {workout.reps} reps</span>
                              )}
                            </div>
                            <p className="text-xs text-orange-400 mt-2">{formatDate(workout.date)}</p>
                          </div>
                        </div>
                        <button
                          onClick={() => {
                            if (confirm('Delete this workout?')) deleteWorkout(workout.id);
                          }}
                          className="p-2 hover:bg-white/10 rounded-lg transition-colors"
                        >
                          <Trash2 className="text-red-400" size={18} />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Active Goals Preview */}
            {goals.length > 0 && (
              <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                  <Target className="text-green-400" />
                  Active Goals
                </h2>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {goals.slice(0, 4).map(goal => {
                    const progress = (goal.current / goal.target) * 100;
                    const isComplete = progress >= 100;
                    
                    return (
                      <div key={goal.id} className="bg-white/10 rounded-lg p-4">
                        <div className="flex items-center justify-between mb-2">
                          <span className="text-white font-semibold capitalize">{goal.type} Goal</span>
                          {isComplete && <Check className="text-green-400" size={20} />}
                        </div>
                        <p className="text-orange-200 mb-2">{goal.current} / {goal.target}</p>
                        <div className="bg-white/20 rounded-full h-3 overflow-hidden">
                          <div
                            className={`h-full transition-all ${
                              isComplete ? 'bg-green-500' : 'bg-gradient-to-r from-orange-500 to-red-500'
                            }`}
                            style={{ width: `${Math.min(progress, 100)}%` }}
                          />
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
        )}

        {/* History View */}
        {view === 'history' && (
          <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
            <h2 className="text-2xl font-bold text-white mb-4">Workout History</h2>
            {workouts.length === 0 ? (
              <div className="text-center py-12">
                <Calendar className="mx-auto text-orange-300 mb-4 opacity-50" size={64} />
                <p className="text-orange-200 text-lg">No workout history</p>
              </div>
            ) : (
              <div className="space-y-3">
                {workouts.map(workout => (
                  <div
                    key={workout.id}
                    className="bg-white/10 rounded-lg p-4 hover:bg-white/20 transition-colors"
                  >
                    <div className="flex items-start justify-between">
                      <div className="flex items-start gap-3 flex-1">
                        <span className="text-3xl">{getWorkoutTypeIcon(workout.type)}</span>
                        <div className="flex-1">
                          <h3 className="text-lg font-bold text-white mb-1">{workout.name}</h3>
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm text-orange-300 mb-2">
                            <span className="flex items-center gap-1">
                              <Clock size={14} />
                              {workout.duration} min
                            </span>
                            {workout.calories && (
                              <span className="flex items-center gap-1">
                                <Flame size={14} />
                                {workout.calories} cal
                              </span>
                            )}
                            {workout.distance && (
                              <span>Distance: {workout.distance} km</span>
                            )}
                            {workout.weight && (
                              <span>Weight: {workout.weight} kg</span>
                            )}
                          </div>
                          {workout.notes && (
                            <p className="text-orange-200 text-sm italic mt-2">{workout.notes}</p>
                          )}
                          <p className="text-xs text-orange-400 mt-2">{formatDate(workout.date)}</p>
                        </div>
                      </div>
                      <button
                        onClick={() => {
                          if (confirm('Delete this workout?')) deleteWorkout(workout.id);
                        }}
                        className="p-2 hover:bg-white/10 rounded-lg transition-colors"
                      >
                        <Trash2 className="text-red-400" size={18} />
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* Goals View */}
        {view === 'goals' && (
          <div className="space-y-6">
            <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-2xl font-bold text-white flex items-center gap-2">
                  <Target className="text-green-400" />
                  Your Goals
                </h2>
                <button
                  onClick={() => setShowGoalForm(true)}
                  className="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold flex items-center gap-2 transition-all"
                >
                  <Plus size={18} />
                  New Goal
                </button>
              </div>

              {goals.length === 0 ? (
                <div className="text-center py-12">
                  <Target className="mx-auto text-orange-300 mb-4 opacity-50" size={64} />
                  <p className="text-orange-200 text-lg">No goals set yet</p>
                  <p className="text-orange-300 text-sm mt-2">Create your first fitness goal!</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {goals.map(goal => {
                    const progress = (goal.current / goal.target) * 100;
                    const isComplete = progress >= 100;
                    const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                    
                    return (
                      <div key={goal.id} className="bg-white/10 rounded-lg p-6">
                        <div className="flex items-start justify-between mb-4">
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-2">
                              <span className="text-xl font-bold text-white capitalize">{goal.type} Goal</span>
                              {isComplete && (
                                <span className="px-3 py-1 bg-green-500 text-white text-xs rounded-full font-semibold flex items-center gap-1">
                                  <Check size={14} />
                                  Completed!
                                </span>
                              )}
                            </div>
                            <p className="text-orange-200">
                              Target: {goal.target} | Deadline: {formatDate(goal.deadline)}
                              {daysLeft > 0 && !isComplete && (
                                <span className="ml-2 text-sm">({daysLeft} days left)</span>
                              )}
                            </p>
                          </div>
                          <button
                            onClick={() => {
                              if (confirm('Delete this goal?')) deleteGoal(goal.id);
                            }}
                            className="p-2 hover:bg-white/10 rounded-lg transition-colors"
                          >
                            <Trash2 className="text-red-400" size={18} />
                          </button>
                        </div>

                        <div className="mb-3">
                          <div className="flex justify-between text-sm text-orange-300 mb-2">
                            <span>Progress</span>
                            <span>{goal.current} / {goal.target} ({Math.min(progress, 100).toFixed(0)}%)</span>
                          </div>
                          <div className="bg-white/20 rounded-full h-4 overflow-hidden">
                            <div
                              className={`h-full transition-all ${
                                isComplete ? 'bg-green-500' : 'bg-gradient-to-r from-orange-500 to-red-500'
                              }`}
                              style={{ width: `${Math.min(progress, 100)}%` }}
                            />
                          </div>
                        </div>

                        {!isComplete && (
                          <div className="flex gap-2">
                            <input
                              type="number"
                              placeholder="Update progress"
                              className="flex-1 px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                              onKeyPress={(e) => {
                                if (e.key === 'Enter' && e.target.value) {
                                  updateGoalProgress(goal.id, parseInt(e.target.value));
                                  e.target.value = '';
                                }
                              }}
                            />
                            <button
                              onClick={(e) => {
                                const input = e.target.previousSibling;
                                if (input.value) {
                                  updateGoalProgress(goal.id, parseInt(input.value));
                                  input.value = '';
                                }
                              }}
                              className="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold"
                            >
                              Update
                            </button>
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        )}

        {/* Workout Form Modal */}
        {showWorkoutForm && (
          <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
            <div className="bg-gray-900 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-orange-500/30">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-2xl font-bold text-white">Log Workout</h2>
                <button
                  onClick={() => {
                    setShowWorkoutForm(false);
                    resetWorkoutForm();
                  }}
                  className="p-2 hover:bg-white/10 rounded-lg transition-colors"
                >
                  <X className="text-white" size={24} />
                </button>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="block text-orange-200 mb-2">Workout Type *</label>
                  <select
                    value={workoutForm.type}
                    onChange={(e) => setWorkoutForm({ ...workoutForm, type: e.target.value })}
                    className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-400"
                  >
                    {workoutTypes.map(type => (
                      <option key={type.value} value={type.value}>
                        {type.icon} {type.label}
                      </option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block text-orange-200 mb-2">Workout Name *</label>
                  <input
                    type="text"
                    value={workoutForm.name}
                    onChange={(e) => setWorkoutForm({ ...workoutForm, name: e.target.value })}
                    className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                    placeholder="e.g., Morning Run, Chest Day"
                  />
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-orange-200 mb-2">Duration (minutes) *</label>
                    <input
                      type="number"
                      value={workoutForm.duration}
                      onChange={(e) => setWorkoutForm({ ...workoutForm, duration: e.target.value })}
                      className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                      placeholder="30"
                    />
                  </div>

                  <div>
                    <label className="block text-orange-200 mb-2">Calories Burned</label>
                    <input
                      type="number"
                      value={workoutForm.calories}
                      onChange={(e) => setWorkoutForm({ ...workoutForm, calories: e.target.value })}
                      className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                      placeholder="200"
                    />
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-orange-200 mb-2">Distance (km)</label>
                    <input
                      type="number"
                      step="0.1"
                      value={workoutForm.distance}
                      onChange={(e) => setWorkoutForm({ ...workoutForm, distance: e.target.value })}
                      className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                      placeholder="5.0"
                    />
                  </div>

                  <div>
                    <label className="block text-orange-200 mb-2">Weight (kg)</label>
                    <input
                      type="number"
                      value={workoutForm.weight}
                      onChange={(e) => setWorkoutForm({ ...workoutForm, weight: e.target.value })}
                      className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                      placeholder="50"
                    />
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-orange-200 mb-2">Sets</label>
                    <input
                      type="number"
                      value={workoutForm.sets}
                      onChange={(e) => setWorkoutForm({ ...workoutForm, sets: e.target.value })}
                      className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                      placeholder="3"
                    />
                  </div>

                  <div>
                    <label className="block text-orange-200 mb-2">Reps</label>
                    <input
                      type="number"
                      value={workoutForm.reps}
                      onChange={(e) => setWorkoutForm({ ...workoutForm, reps: e.target.value })}
                      className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                      placeholder="12"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-orange-200 mb-2">Notes</label>
                  <textarea
                    value={workoutForm.notes}
                    onChange={(e) => setWorkoutForm({ ...workoutForm, notes: e.target.value })}
                    className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                    rows="3"
                    placeholder="How did you feel? Any observations?"
                  />
                </div>

                <div className="flex gap-3 pt-4">
                  <button
                    onClick={logWorkout}
                    className="flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-semibold transition-all"
                  >
                    Log Workout
                  </button>
                  <button
                    onClick={() => {
                      setShowWorkoutForm(false);
                      resetWorkoutForm();
                    }}
                    className="px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-semibold transition-all"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Goal Form Modal */}
        {showGoalForm && (
          <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
            <div className="bg-gray-900 rounded-xl p-6 max-w-md w-full border border-orange-500/30">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-2xl font-bold text-white">Create Goal</h2>
                <button
                  onClick={() => {
                    setShowGoalForm(false);
                    resetGoalForm();
                  }}
                  className="p-2 hover:bg-white/10 rounded-lg transition-colors"
                >
                  <X className="text-white" size={24} />
                </button>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="block text-orange-200 mb-2">Goal Type *</label>
                  <select
                    value={goalForm.type}
                    onChange={(e) => setGoalForm({ ...goalForm, type: e.target.value })}
                    className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-400"
                  >
                    <option value="workout">Total Workouts</option>
                    <option value="calories">Calories Burned</option>
                    <option value="distance">Distance (km)</option>
                    <option value="duration">Time (minutes)</option>
                  </select>
                </div>

                <div>
                  <label className="block text-orange-200 mb-2">Target *</label>
                  <input
                    type="number"
                    value={goalForm.target}
                    onChange={(e) => setGoalForm({ ...goalForm, target: e.target.value })}
                    className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-orange-300 focus:outline-none focus:ring-2 focus:ring-orange-400"
                    placeholder="e.g., 20 workouts, 5000 calories"
                  />
                </div>

                <div>
                  <label className="block text-orange-200 mb-2">Deadline *</label>
                  <input
                    type="date"
                    value={goalForm.deadline}
                    onChange={(e) => setGoalForm({ ...goalForm, deadline: e.target.value })}
                    className="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-400"
                  />
                </div>

                <div className="flex gap-3 pt-4">
                  <button
                    onClick={createGoal}
                    className="flex-1 px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-all"
                  >
                    Create Goal
                  </button>
                  <button
                    onClick={() => {
                      setShowGoalForm(false);
                      resetGoalForm();
                    }}
                    className="px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-semibold transition-all"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
